function editar(e) { window.location.href = homePage + "Admin/Recurso/Cadastro/" + e } function enviarRecurso(e, o) { $.blockUI({ message: mensagemEnviandoRecurso, css: cssCarregando }); var a = homePage + "Concurso/EnviarRecurso", n = ""; $(".recurso-isencao ").find("#txtNomeCompleto").length > 0 ? (n += labelNome + ": " + $(".recurso-isencao ").find("#txtNomeCompleto").val() + "<br>", n += labelCPF + ": " + $(".recurso-isencao ").find(".cpfRecurso").html() + "<br>", n += labelIdentSocial + ": " + $(".recurso-isencao ").find("#txtIdentSocial").val() + "<br>", n += labelDataNasc + ": " + $(".recurso-isencao ").find("#txtDataNascimento").val() + "<br>", n += labelSexo + ": " + ("F" == $(".recurso-isencao ").find("#ddlSexo").val() ? optionFeminino : optionMasculino) + "<br>", n += labelRG + ": " + $(".recurso-isencao ").find("#txtRG").val() + "<br>", n += labelDataExpedicaoRG + ": " + $(".recurso-isencao ").find("#txtDataExpedicaoRG").val() + "<br>", n += labelOrgaoExpedidorRG + ": " + $(".recurso-isencao ").find("#txtOrgaoExpedidorRG").val() + "<br>", n += labelNomeMae + ": " + $(".recurso-isencao ").find("#txtNomeMae").val()) : n = $("#txtMensagem").val(), $.ajax({ type: "POST", url: a, data: { idConcurso: e, idInscrito: o, mensagem: encodeURIComponent(n) }, success: function (e) { if (e > 0) { var o = homePage + "Concurso/EnviarRecursoEmail"; $.ajax({ type: "POST", url: o, success: function (e) { $(".recursoForm").data("bootstrapValidator").resetForm(), $(".recurso-isencao ").find("#txtNomeCompleto").length > 0 ? ($(".recurso-isencao ").find("input[type=text]").attr("readonly", "readonly"), $(".recurso-isencao ").find("select").attr("readonly", "readonly"), $(".declaracao").hide()) : ($(".mensagem-aviso").hide(), $(".upload-file").parent().hide(), $("#txtMensagem").attr("readonly", "readonly")), $("#btnSalvar").hide(), $("#btnVoltarOK").show(), $(".mensagem-protocolo").html(mensagemRecursoAbertoSucesso.replace("{0}", e.Protocolo)), $(".mensagem-protocolo").show(), $.unblockUI() }, error: function (e, o, a) { alertaErroJS({ NomeFuncao: "enviarRecursoEmail()", ResponseText: e.responseText }), $.unblockUI() } }) } else $.unblockUI() }, error: function (e, o, a) { alertaErroJS({ NomeFuncao: "enviarRecurso()", ResponseText: e.responseText }), $.unblockUI() } }) } function iniciarFormularioRecurso(e) { var o = (e.idConcurso, e.idInscrito), a = e.inscricaoRequerente, n = e.nomeRequerente, r = e.cargoRequerente; $(".recurso-isencao").find("#txtNomeCompleto").length > 0 ? ($(".declaracao").show(), $(".recurso-isencao").find("#txtDataNascimento").mask("00/00/0000"), $(".recurso-isencao").find("#txtDataExpedicaoRG").mask("00/00/0000"), $(".recurso-isencao ").find("input[type=text]").removeAttr("readonly"), $(".recurso-isencao ").find("select").removeAttr("readonly"), $(".recurso-isencao").find("input[type=text]").val(""), $(".recurso-isencao").find("input[type=text]").parent().removeClass("has-success").removeClass("has-error"), $(".recurso-isencao").find("input[type=text]").parent().find("i").hide(), $(".recurso-isencao").find("input[type=text]").parent().find(".help-block").hide(), $(".recurso-isencao").find("select").val(""), $(".recurso-isencao").find("select").parent().removeClass("has-success").removeClass("has-error"), $(".recurso-isencao").find("select").parent().find("i").hide(), $(".recurso-isencao").find("select").parent().find(".help-block").hide()) : ($("#txtMensagem").removeAttr("readonly"), $("#txtMensagem").val(""), $("#txtMensagem").parent().removeClass("has-success").removeClass("has-error"), $("#txtMensagem").parent().find("i").hide(), $("#txtMensagem").parent().find(".help-block").hide(), $(".upload-file").parent().removeClass("has-success").removeClass("has-error"), $(".upload-file").parent().find("i").hide(), $(".upload-file").parent().find(".help-block").hide(), $(".upload-file").parent().show(), $("#txtUploadFile").val(""), $("#txtUploadFile").on("change", function (e) { uploadFileAnexoRecurso(e) }), $(".inscricao-requerente").html(a), $(".nome-requerente").html(n), $(".cargo-requerente").html(r), $(".mensagem-aviso").show(), $(".mensagem-protocolo").hide()), $(".cpf-requerente-cargos").html(""), $("#btnVoltarOK").hide(), $("#btnVoltarOK").on("click", function () { $('a[data-content="publicacoes"]').trigger("click") }), $("#btnSalvar").show(), $("#hdnIdInscrito").val(o), $(".cpf-requerente").fadeOut(500).promise().done(function () { $(".recursoForm").fadeIn(500).promise().done(function () { tabsContentResize(150 - $(".recursoForm").height()), $(".recurso-isencao ").find("#txtNomeCompleto").length > 0 ? ($(".recurso-isencao").find(".cpfRecurso").html($(".recurso-cadastro-usuario").find("#txtCPF").val()), $(".recursoForm").find("#txtNomeCompleto").focus()) : $(".recursoForm").find("#txtMensagem").focus() }) }) } function iniciarFormularioRecursoBootstrap() { $("#txtCPF").mask("999.999.999-99"), $(".recursoForm").on("init.field.bv", function (e, o) { removerIconeValidator(e, o) }).bootstrapValidator({ container: "tooltip", feedbackIcons: { valid: "glyphicon glyphicon-ok", invalid: "glyphicon glyphicon-remove", validating: "glyphicon glyphicon-refresh" }, fields: { nome: { validators: { notEmpty: { message: nomeObrigatorio } } }, cpfRecurso: { validators: { notEmpty: { message: cpfObrigatorio } } }, identSocial: { validators: { notEmpty: { message: identSocialObrigatorio } } }, sexo: { validators: { notEmpty: { message: sexoObrigatorio } } }, rg: { validators: { notEmpty: { message: rgObrigatorio } } }, orgaoExpedidorRG: { validators: { notEmpty: { message: orgaoExpedidorRGObrigatorio } } }, nomeMae: { validators: { notEmpty: { message: nomeMaeObrigatorio } } }, dataNasc: { validators: { notEmpty: { message: dataNascObrigatorio }, date: { message: dataNascFormatoInvalido, format: "DD/MM/YYYY", min: "01/01/1920" } } }, dataDataExpedicaoRG: { validators: { notEmpty: { message: dataExpedicaoRGObrigatorio }, date: { message: dataExpedicaoRGFormatoInvalido, format: "DD/MM/YYYY", min: "01/01/1920" } } }, mensagem: { validators: { notEmpty: { message: mensagemObrigatoria } } }, UploadFile: { validators: { file: { extension: "pdf,doc,docx", type: "application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document", maxSize: 2097152, message: arquivoFormatoInvalido } } } } }).on("success.form.bv", function (e) { e.preventDefault(); var o = $("#hdnIdConcurso").val(), a = $(".aba-recurso").find("#hdnIdInscrito").val(); enviarRecurso(o, a) }) } function iniciarTelaCadastroRecurso(e, o, a, n, r) { listarAnexosRequerente(a, n, r), $("#txtUploadFile").on("change", function (e) { uploadFileAnexos(e, o, n, r) }), $(".recursoForm").on("init.field.bv", function (e, o) { removerIconeValidator(e, o) }).bootstrapValidator({ container: "tooltip", feedbackIcons: { valid: "glyphicon glyphicon-ok", invalid: "glyphicon glyphicon-remove", validating: "glyphicon glyphicon-refresh" }, fields: { resposta: { validators: { notEmpty: { message: respostaObrigatorio } } }, txtComentario: { validators: { notEmpty: { message: comentarioObrigatorio } } } } }).on("success.form.bv", function (a) { a.preventDefault(), salvar(e, o) }), r || $("#btnSalvar").hide() } function iniciarTelaListaRecursos() { listarRecursos() } function listarAnexosAtendente(e, o, a) { e && $.blockUI({ message: mensagemCarregandoAnexos, css: cssCarregando }); var n = homePage + "Base/ListarAnexos"; $.ajax({ type: "POST", url: n, data: { pathAnexos: o }, success: function (n) { $(".anexo-atendente").html(""), $(".anexo-atendente").append(n.View), a && ($(".anexo-atendente").find(".remover-anexo").show(), $(".anexo-atendente").find(".remover-anexo").on("click", function () { removerAnexo($(this).attr("path"), function () { listarAnexosAtendente(e, o, a) }) })), $(".anexo-atendente").find(".col-md-4").length >= 3 ? $(".upload-file").hide() : $(".upload-file").show(), $.unblockUI() }, error: function (e, o, a) { alertaErroJS({ NomeFuncao: "listarAnexosAtendente()", ResponseText: e.responseText }), $.unblockUI() } }) } function listarAnexosRequerente(e, o, a) { $.blockUI({ message: mensagemCarregandoAnexos, css: cssCarregando }); var n = homePage + "Base/ListarAnexos"; $.ajax({ type: "POST", url: n, data: { pathAnexos: e }, success: function (e) { $(".anexo-requerente").html(""), $(".anexo-requerente").append(e.View), listarAnexosAtendente(!1, o, a) }, error: function (e, o, a) { alertaErroJS({ NomeFuncao: "listarAnexosRequerente()", ResponseText: e.responseText }), $.unblockUI() } }) } function listarRecursos() { $.blockUI({ message: mensagemCarregando, css: cssCarregando }); var e = homePage + "Admin/Recurso/ListarRecursos"; $.ajax({ type: "POST", url: e, success: function (e) { $(".lista").html(""), $(".lista").append(e), montarTabela(), $(".lista").find("table").attr("summary") == naoEncontrado && $(".lista").css("marginTop", 0), $(".redirecionar").on("click", function () { editar($(this).closest("tr").find("td:first span").html()) }), $.unblockUI() }, error: function (e, o, a) { alertaErroJS({ NomeFuncao: "listarRecursos()", ResponseText: e.responseText }), $.unblockUI() } }) } function montarTabela() { $.fn.dataTable.moment("DD/MM/YYYY"), oTable = $("#tblRecursos").dataTable({ bLengthChange: !1, order: [[1, "desc"]], aoColumnDefs: [{ bSortable: !1, aTargets: [7] }], language: { url: urlDataTable }, fnDrawCallback: function (e) { $("#tblRecursos_filter input").focus() } }) } function salvar(e, o) { var a = $("#txtComentario").val(), n = $("#rDeferido").is(":checked"); $.blockUI({ message: mensagemEnviando, css: cssCarregando }); var r = homePage + "Admin/Recurso/Enviar"; $.ajax({ type: "POST", url: r, data: { idRecurso: o, comentario: a, deferido: n }, success: function (o) { alert(o.Mensagem), o.Sucesso && (window.location.href = homePage + "Admin/Recurso/Index/" + e), $.unblockUI() }, error: function (e, o, a) { alertaErroJS({ NomeFuncao: "salvar()", ResponseText: e.responseText }), $.unblockUI() } }) } function uploadFileAnexos(e, o, a, n) { $.blockUI({ message: mensagemRealizandoUpload, css: cssCarregando }); var r = e.target.files; if (r.length > 0 && void 0 !== window.FormData) { for (var t = new FormData, s = 0; s < r.length; s++) t.append("file" + s, r[s]); $.ajax({ type: "POST", url: homePage + "/Base/UploadFiles?idRecurso=" + o + "&atendente=true", contentType: !1, processData: !1, data: t, success: function (e) { $("#txtUploadFile").val(""), e.Sucesso ? (listarAnexosAtendente(!1, a, n), $(".sucesso").fadeIn(1e3).fadeOut(3e3)) : ($(".erro").fadeIn(1e3).fadeOut(3e3), $.unblockUI()) }, error: function (e, o, a, n) { alertaErroJS({ NomeFuncao: "uploadFileAnexos()", ResponseText: e.responseText }), $.unblockUI() } }) } } var oTable;
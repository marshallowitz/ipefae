function abrirModalLogin() { var o = $(window).width() < 800, n = homePage + "Account/AbrirModalLogin"; return $.ajax({ type: "POST", url: n, success: function (n) { $("html, body").animate({ scrollTop: 0 }, "slow"), $("section#modal-login").html(""), $("section#modal-login").html(n.View), iniciarTelaModalLogin(), $("section#modal-login").parent().context.URL.indexOf("Concurso") > 0 && !o && $("section#modal-login").find(".confirmar").css("marginTop", "-20px"), $(".modal-login").modal("show") }, error: function (o) { alertaErroJS({ NomeFuncao: "abrirModalLogin()", ResponseText: o.responseText }) } }), !1 } function definirTelaAposLogin(o, n, a) { $(".ulLogado").show(), $(".ulDeslogado").hide(); var i = homePage + a; n && $(".menu-admin").show(), $(".modal-login").modal("hide"), window.location.href = i } function iniciarTelaLogin() { verificarUsuarioLogado(), $(".menu-login-li").on("mouseover", function () { $(".menu-login-entrar").stop().animate({ width: "toggle" }, "slow") }), $(".menu-login-li").on("mouseout", function () { $(".menu-login-entrar").stop().animate({ width: "toggle" }, "slow") }), $("section#modal-login").on("shown.bs.modal", function () { $("section#modal-login").find("#txtEmail").focus() }), $("section#modal-login").on("hidden.bs.modal", function () { $("section#modal-login").find("#txtEmail").val(""), $("section#modal-login").find("#txtSenha").val("") }) } function iniciarTelaModalLogin() { $(".modal-login").on("show.bs.modal", function () { $(".frmLogin").on("init.field.bv", function (o, n) { removerIconeValidator(o, n) }).bootstrapValidator({ container: "tooltip", feedbackIcons: { valid: "glyphicon glyphicon-ok", invalid: "glyphicon glyphicon-remove", validating: "glyphicon glyphicon-refresh" }, fields: { email: { validators: { notEmpty: { message: emailObrigatorio }, emailAddress: { message: formatoInvalidoEmail } } }, senha: { validators: { notEmpty: { message: senhaObrigatoria } } } } }).on("success.form.bv", function (o) { o.preventDefault(); var n = $(this).find("#txtEmail").val(), a = $(this).find("#txtSenha").val(); $(this).find("#txtEmail").val(""), $(this).find("#txtSenha").val(""), realizarLogin(n, a) }); var o = $(".modal-login").find("#txtEmail"); o.val(""), o.parents(".form-group").find('.form-control-feedback[data-bv-icon-for="email"]').trigger("click.clearing"); var n = $(".modal-login").find("#txtSenha"); n.val(""), n.parents(".form-group").find('.form-control-feedback[data-bv-icon-for="senha"]').trigger("click.clearing") }), $(".modal-login").on("shown.bs.modal", function () { "" === $(".modal-login").find("#txtEmail").val() ? $(".modal-login").find("#txtEmail").focus() : $(".modal-login").find("#txtSenha").focus() }), $(".modal-login").on("hidden.bs.modal", function () { var o = $("#txtEmail"); o.val(""), o.parents(".form-group").find('.form-control-feedback[data-bv-icon-for="email"]').trigger("click.clearing"), o.focus() }) } function realizarLogin(o, n) { $.blockUI({ message: mensagemBlockUILogin, css: cssCarregando }), $(".frmLogin").closest(".modal-dialog").hide(); var a = homePage + "Account/RealizarLogin"; return $.ajax({ type: "POST", url: a, data: { email: o, senha: n }, success: function (o) { if ($(".frmLogin").bootstrapValidator("resetForm", !0), "ok" == o.status.toLowerCase()) definirTelaAposLogin(o.Mensagem, o.Admin, o.Url); else { if ("senhaerrada" == o.status.toLowerCase()) return $.unblockUI(), alert(o.Mensagem), $(".frmLogin").closest(".modal-dialog").show(), void $(".frmLogin").find("#txtEmail").focus(); alert(erroLogin) } $.unblockUI() }, error: function (o) { $.unblockUI(), alertaErroJS({ NomeFuncao: "realizarLogin()", ResponseText: o.responseText }) } }), !1 } function realizarLogOff() { $.blockUI({ message: mensagemBlockUILogoff, css: cssCarregando }); var o = homePage + "Account/LogOff"; return $.ajax({ type: "POST", url: o, success: function () { window.location.href = homePage, $.unblockUI() }, error: function (o) { $.unblockUI(), alertaErroJS({ NomeFuncao: "realizarLogOff()", ResponseText: o.responseText }) } }), !1 } function verificarUsuarioLogado() { $(".ulLogado").hide(), $(".ulDeslogado").hide(), $(".menu-admin").hide(); var o = homePage + "Account/VerificarUsuarioLogado"; return $.ajax({ type: "POST", url: o, success: function (o) { o.Logado ? ($(".spanOla").html(o.Ola), $(".ulLogado").show(), o.Admin && $(".menu-admin").show()) : $(".ulDeslogado").show() }, error: function (o) { alertaErroJS({ NomeFuncao: "verificarUsuarioLogado()", ResponseText: o.responseText }) } }), !1 }